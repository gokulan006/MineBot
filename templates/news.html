<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Latest mining industry news and updates from NeuroMine">
    <title>Mining News Summary | NeuroMine</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="{{ url_for('static', filename='news.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='logo.png') }}" type="image/png">
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <img class="logo" src="{{ url_for('static', filename='logo.png') }}" alt="NeuroMine Logo" width="40" height="40">
            <span class="app-name">NeuroMine</span>
        </div>
        
        <div class="sidebar-section">
            <button class="nav-btn" onclick="window.location.href='/'">
                <i class="fas fa-arrow-left btn-icon" aria-hidden="true"></i>
                <span class="btn-text">Back to Chat</span>
            </button>
        </div>
        
        <div class="sidebar-section">
            <h2 class="sidebar-title">Date Range</h2>
            <div class="date-filter">
                <label for="startDate" class="sr-only">Start Date</label>
                <input type="date" id="startDate" class="date-input" aria-label="Start date">
                <span class="date-separator">to</span>
                <label for="endDate" class="sr-only">End Date</label>
                <input type="date" id="endDate" class="date-input" aria-label="End date">
            </div>
        </div>
        
        <div class="sidebar-section">
            <h2 class="sidebar-title">Categories</h2>
            <div class="category-filter">
                <button class="category-btn active">All News</button>
                <button class="category-btn">Market Trends</button>
                <button class="category-btn">Regulations</button>
                <button class="category-btn">Technology</button>
                <button class="category-btn">Sustainability</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <header class="news-header">
            <h1><i class="fas fa-newspaper" aria-hidden="true"></i> Mining Industry News</h1>
            <div class="search-bar">
                <label for="newsSearch" class="sr-only">Search news articles</label>
                <input type="text" id="newsSearch" placeholder="Search news..." aria-label="Search news articles">
                <button type="button" aria-label="Search"><i class="fas fa-search" aria-hidden="true"></i></button>
            </div>
        </header>
        
        <div class="news-filters">
            <div class="filter-group">
                <label for="timeFilter">Time Period:</label>
                <select id="timeFilter" aria-label="Filter by time period">
                    <option value="all">All Items</option>
                    <option value="7days">Last 7 Days</option>
                    <option value="30days">Last 30 Days</option>
                    <option value="custom">Custom Range</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="sortFilter">Sort By:</label>
                <select id="sortFilter" aria-label="Sort articles by">
                    <option value="newest">Newest First</option>
                    <option value="oldest">Oldest First</option>
                    <option value="relevance">Relevance</option>
                </select>
            </div>
        </div>
        
        <div class="news-grid" id="newsGrid" role="list">
            {% for article in articles %}
            <article class="news-card" role="listitem">
                <div class="news-meta">
                    <time class="news-date" datetime="{{ article.published_date_iso }}">{{ article.published_date }}</time>
                    <span class="news-source">{{ article.source }}</span>
                </div>
                <h2 class="news-title">{{ article.headline }}</h2>
                <div class="news-summary" aria-expanded="false">
                    <p>{{ article.summarized_text }}</p>
                </div>
                <div class="news-actions">
                    <button class="news-action-btn" aria-label="Save article"><i class="fas fa-bookmark" aria-hidden="true"></i> Save</button>
                    <button class="news-action-btn" aria-label="Share article"><i class="fas fa-share" aria-hidden="true"></i> Share</button>
                    <button class="news-action-btn read-more-btn" aria-expanded="false" aria-controls="summary-{{ loop.index }}">
                        <span class="btn-text">Read More</span>
                        <i class="fas fa-chevron-down" aria-hidden="true"></i>
                    </button>
                </div>
                <a href="{{ article.url }}" class="news-link" target="_blank" rel="noopener noreferrer" aria-label="Read full article: {{ article.headline }}">Read full article</a>
            </article>
            {% endfor %}
        </div>

        <nav class="pagination" aria-label="News pagination">
            <button class="pagination-btn" disabled aria-label="Previous page">
                <i class="fas fa-chevron-left" aria-hidden="true"></i>
            </button>
            <button class="pagination-btn active" aria-label="Page 1" aria-current="page">1</button>
            <button class="pagination-btn" aria-label="Page 2">2</button>
            <button class="pagination-btn" aria-label="Page 3">3</button>
            <span class="pagination-ellipsis">...</span>
            <button class="pagination-btn" aria-label="Page 10">10</button>
            <button class="pagination-btn" aria-label="Next page">
                <i class="fas fa-chevron-right" aria-hidden="true"></i>
            </button>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Toggle news summary visibility with enhanced accessibility
            document.querySelectorAll('.read-more-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const card = this.closest('.news-card');
                    const summary = card.querySelector('.news-summary');
                    const icon = this.querySelector('i');
                    const isExpanded = summary.getAttribute('aria-expanded') === 'true';
                    
                    // Toggle states
                    summary.setAttribute('aria-expanded', !isExpanded);
                    this.setAttribute('aria-expanded', !isExpanded);
                    
                    if (!isExpanded) {
                        icon.classList.replace('fa-chevron-down', 'fa-chevron-up');
                        this.querySelector('.btn-text').textContent = 'Read Less';
                    } else {
                        icon.classList.replace('fa-chevron-up', 'fa-chevron-down');
                        this.querySelector('.btn-text').textContent = 'Read More';
                    }
                });
            });
            
            // Set default dates
            const today = new Date();
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(today.getDate() - 30);
            
            document.getElementById('endDate').valueAsDate = today;
            document.getElementById('startDate').valueAsDate = thirtyDaysAgo;
            
            // Date range validation
            document.getElementById('startDate').addEventListener('change', function() {
                const startDate = new Date(this.value);
                const endDate = new Date(document.getElementById('endDate').value);
                
                if (startDate > endDate) {
                    alert('Start date cannot be after end date');
                    this.value = '';
                }
            });
            
            document.getElementById('endDate').addEventListener('change', function() {
                const endDate = new Date(this.value);
                const startDate = new Date(document.getElementById('startDate').value);
                
                if (endDate < startDate) {
                    alert('End date cannot be before start date');
                    this.value = '';
                }
            });
            
            // Search functionality
            document.getElementById('newsSearch').addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const cards = document.querySelectorAll('.news-card');
                
                cards.forEach(card => {
                    const title = card.querySelector('.news-title').textContent.toLowerCase();
                    const summary = card.querySelector('.news-summary').textContent.toLowerCase();
                    
                    if (title.includes(searchTerm) || summary.includes(searchTerm)) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            });
            
            // Filter functionality
            document.getElementById('timeFilter').addEventListener('change', function() {
                const filterValue = this.value;
                const cards = document.querySelectorAll('.news-card');
                const now = new Date();
                
                cards.forEach(card => {
                    const dateText = card.querySelector('.news-date').getAttribute('datetime');
                    const articleDate = new Date(dateText);
                    
                    let shouldShow = true;
                    
                    if (filterValue === '7days') {
                        const sevenDaysAgo = new Date();
                        sevenDaysAgo.setDate(now.getDate() - 7);
                        shouldShow = articleDate >= sevenDaysAgo;
                    } else if (filterValue === '30days') {
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(now.getDate() - 30);
                        shouldShow = articleDate >= thirtyDaysAgo;
                    }
                    
                    card.style.display = shouldShow ? 'block' : 'none';
                });
            });
        });
    </script>
</body>
</html>